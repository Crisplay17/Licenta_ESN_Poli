<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/user_profile.css"> <!-- Fișierul CSS pentru stilizare -->
    <style>
        /* Stiluri suplimentare pentru buton */
        .center1 {
            text-align: center; /* Aliniere buton în centru */
        }

        .btn-submit1 {
            margin-top: 4px; /* Spațierea deasupra a butonului */
            padding: 5px 10px; /* Dimensiunea butonului */
            font-size: 16px; /* Dimensiunea textului */
        }
        .error-message {
            color: red; /* Culorea textului de eroare */
            text-align: center;
        }
        .success-message {
            color: green; /* Culorea textului de eroare */
            text-align: center;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>User Profile</h2>
    <form action="/volunteers/profilePicture" method="post" enctype="multipart/form-data" class="profile-form">
        <div class="user-profile">
            <img id="profile-picture" th:src="@{/volunteers/profilePicture}" alt="Profile Picture" >
            <div class="overlay">
                <label for="profilePicture" class="custom-file-upload">
                    <i class="fa fa-cloud-upload"></i> Upload New Picture
                </label>
                <input type="file" id="profilePicture" name="profilePicture" accept="image/*">
            </div>
        </div>
        <div class="center1"> <!-- Container pentru alinierea butonului -->
            <button  type="submit"  class="btn-submit1">Save Image</button>
        </div>
        <p id="error-message" class="error-message"></p>
        <p id="success-message" class="success-message"></p>
    </form>
    <form action="/volunteers/profile" method="post"  enctype="multipart/form-data" class="profile-form">
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" th:value="${user.username}" readonly>
        </div>

        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" th:value="${user.email}">
        </div>
        <div class="form-group">
            <label for="password">New Password:</label>
            <input type="password" id="password" name="password" th:value="${user.password}">
        </div>
        <div class="form-group">
            <label for="repeatPassword">Repeat New Password:</label>
            <input type="password" id="repeatPassword" name="repeatPassword" >
        </div>
        <div class="form-group">
            <label for="nationality">Nationality:</label>
            <input type="text" id="nationality" name="nationality" th:value="${user.nationality}">
        </div>
        <!-- Buton pentru salvarea modificărilor -->
        <div class="center">
            <button type="submit"  class="btn-submit">Save Changes</button>

        </div>
    </form>
</div>

<script>


    document.addEventListener('DOMContentLoaded', function() {
        var form = document.querySelector('.profile-form');
        form.onsubmit = function() {
            return validateForm();
        };
    });



    document.getElementById('profilePicture').addEventListener('change', function () {
        var file = this.files[0];
        if (file) {
            var reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('profile-picture').src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    });

    function validateForm() {
        var fileInput = document.getElementById('profilePicture');
        if (fileInput.files.length === 0) { // Verifică dacă nu s-a încărcat nicio imagine
            var errorMessage = document.getElementById('error-message');
            errorMessage.textContent = "Please select an image."; // Setează mesajul de eroare
            // Ascunde mesajul de eroare după 3 secunde
            setTimeout(function() {
                errorMessage.textContent = ""; // Șterge mesajul de eroare
            }, 3000); // 3000 milisecunde = 3 secunde

            return false; // Împiedică trimiterea formularului către server
        } else {
            var successMessage = document.getElementById('success-message');
            successMessage.textContent = "Image uploaded successfully."; // Setează mesajul de succes
            // Ascunde mesajul de succes după 5 secunde
            setTimeout(function() {
                successMessage.textContent = ""; // Șterge mesajul de succes
            }, 2000); // 5000 milisecunde = 5 secunde

            return true; // Permite trimiterea formularului către server dacă a fost selectată o imagine
        }
    }



    // function updateProfilePicture() {
    //     var fileInput = document.getElementById('profilePicture');
    //     var file = fileInput.files[0];
    //     var formData = new FormData();
    //     formData.append('profilePicture', file);
    //
    //     // Setează src-ul imaginii pentru afișarea imediată
    //     var profilePictureElement = document.getElementById('profile-picture');
    //     profilePictureElement.src = URL.createObjectURL(file);
    //
    //     fetch('/volunteers/profilePicture', {
    //         method: 'POST',
    //         body: formData,
    //         mode:"cors"
    //     })
    //         .then(response => {
    //             if (!response.ok) {
    //                 throw new Error('Failed to update profile picture');
    //             }
    //             return response.json();
    //         })
    //         .then(data => {
    //             console.log('Profile picture updated successfully:', data);
    //             // Intârzie redirecționarea cu 5 secunde pentru a afișa mesajul de succes
    //             setTimeout(function() {
    //                 window.location.href = '/volunteers/profile'; // Redirecționează către pagina de home
    //             }, 5000); // 5000 milisecunde = 5 secunde
    //         })
    //         .catch(error => {
    //             console.error('Error updating profile picture:', error);
    //             validateForm();
    //         });
    // }


</script>

</body>
</html>
